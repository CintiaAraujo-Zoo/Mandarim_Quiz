<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <title>Quiz Mandarim por HSK</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* General Styles */
        body {
            font-family: 'Noto Sans SC', Arial, sans-serif; /* Using a font that supports Chinese characters well */
            background: linear-gradient(135deg, #fff5f5 0%, #ffe4e1 100%); /* Softer gradient */
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
            color: #333;
        }

        /* --- Start Screen --- */
        #start-screen {
            text-align: center;
            background: #fff;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 3px solid #b22222; /* Firebrick border */
            width: 90%;
            max-width: 600px;
            margin-top: 30px;
        }

        #start-screen h1 {
            color: #b22222; /* Firebrick */
            margin-bottom: 15px;
        }

        #start-screen p {
            font-size: 1.1em;
            margin-bottom: 30px;
            color: #555;
        }

        #start-button { /* Ensure this ID matches the one in JS */
            font-size: 20px;
            padding: 15px 30px;
            cursor: pointer;
            border-radius: 8px;
            border: none;
            background-color: #b22222; /* Firebrick */
            color: white;
            transition: background-color 0.3s ease;
        }

        #start-button:hover {
            background-color: #a31f1f; /* Darker shade on hover */
        }

        /* --- Quiz Container --- */
        .quiz-container {
            background: #fff;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border: 3px solid #b22222; /* Firebrick border */
            display: none; /* Hidden initially */
            flex-direction: column;
            align-items: center;
            position: relative; /* Needed if mute button is absolute inside it */
        }

        .header-img {
            text-align: center;
            margin-bottom: 20px;
        }

        .header-img img {
            width: 100px; /* Slightly smaller */
            height: auto;
            border-radius: 5px; /* Optional: slightly round corners */
        }

        h1.quiz-title { /* Different class for quiz title */
            text-align: center;
            color: #b22222; /* Firebrick */
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        /* Level Selector */
        #level-selection {
            margin-bottom: 25px;
            text-align: center;
        }
        #level-selection label {
            margin-right: 10px;
            font-weight: bold;
        }
        select#levelSelect {
            font-size: 16px;
            padding: 8px 12px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }

        /* Progress & Score */
        #progress-info {
            width: 100%;
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 0.95em;
            color: #555;
        }
        #progress-text { }
        #score-text { }


        /* Question Area */
        .question {
            font-size: 1.5em; /* Larger font for Hanzi */
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            color: #444;
            min-height: 50px; /* Ensure space even if text wraps */
        }

        /* Options Area */
        .options button {
            display: block;
            width: 100%;
            margin: 10px 0;
            padding: 15px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 8px;
            border: 1px solid #ccc;
            background-color: #f8f8f8;
            color: #333;
            transition: background-color 0.2s ease, border-color 0.2s ease;
            text-align: center;
        }

        .options button:hover:not(:disabled) {
            background-color: #e9e9e9;
            border-color: #aaa;
        }

        .options button.correct {
            background-color: #d4edda; /* Light Green */
            border-color: #c3e6cb;
            color: #155724;
            font-weight: bold;
        }
        .options button.wrong {
            background-color: #f8d7da; /* Light Red */
            border-color: #f5c6cb;
            color: #721c24;
            font-weight: bold;
        }
        .options button:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* Feedback Area */
        #feedback {
            margin-top: 15px;
            font-weight: bold;
            text-align: center;
            min-height: 25px; /* Reserve space */
            font-size: 1.1em;
        }
        #feedback.correct-feedback {
            color: #155724; /* Dark Green */
        }
        #feedback.wrong-feedback {
            color: #721c24; /* Dark Red */
        }
        #feedback.hint-feedback {
            color: #004085; /* Dark Blue */
        }


        /* Result Area */
        #result {
            font-size: 22px;
            margin-top: 25px;
            text-align: center;
            font-weight: bold;
            color: #b22222; /* Firebrick */
        }

        /* Action Buttons Area */
        .action-buttons {
            display: flex;
            justify-content: space-around; /* Distribute buttons */
            align-items: center;
            width: 100%;
            max-width: 500px; /* Limit width of the button group */
            margin: 25px auto 0; /* Center the group */
        }

        .action-buttons button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 6px;
            color: white;
            min-width: 100px; /* Ensure buttons have decent width */
            text-align: center;
            transition: background-color 0.3s ease, transform 0.1s ease;
        }
        .action-buttons button:active {
             transform: scale(0.98); /* Slight press effect */
        }

        #restart { background-color: #b22222; } /* Firebrick */
        #restart:hover { background-color: #a31f1f; }

        #skip { background-color: #ffc107; } /* Amber */
        #skip:hover { background-color: #e0a800; }

        #hint { background-color: #17a2b8; } /* Info Blue */
        #hint:hover { background-color: #138496; }

        /* Hide elements initially */
        #result, #feedback {
            display: none;
        }

        /* --- Mute Button Style --- */
        #muteButton {
            position: fixed; /* Or absolute within the container */
            top: 15px;
            right: 15px;
            background: #fff;
            border: 1px solid #ccc;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            z-index: 10; /* Ensure it's above other elements */
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: background-color 0.2s ease;
        }
         #muteButton:hover {
             background-color: #f0f0f0;
         }

    </style>
</head>
<body>

    <!-- Start Screen -->
    <div id="start-screen">
        <div class="header-img">
            <img alt="Bandeira da China" src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Flag_of_the_People%27s_Republic_of_China.svg/1920px-Flag_of_the_People%27s_Republic_of_China.svg.png"/>
        </div>
        <h1>Quiz de Mandarim HSK</h1>
        <p>Teste seus conhecimentos de vocabul√°rio!</p>
        <!-- VERIFIQUE SE ESTE BOT√ÉO EST√Å EXATAMENTE ASSIM NO SEU HTML -->
        <button id="start-button">Iniciar Quiz</button>
    </div>

    <!-- Quiz Container -->
    <div class="quiz-container" id="quiz-container">
        <!-- Conte√∫do do quiz como antes -->
        <div class="header-img">
             <img alt="Bandeira da China" src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Flag_of_the_People%27s_Republic_of_China.svg/1920px-Flag_of_the_People%27s_Republic_of_China.svg.png"/>
        </div>
        <h1 class="quiz-title">Quiz de Mandarim</h1>

        <div id="level-selection">
             <label for="levelSelect">N√≠vel:</label>
             <select id="levelSelect" onchange="confirmLevelChange()">
                <option value="HSK1" selected>HSK 1</option>
                <!-- <option value="HSK2">HSK 2</option> -->
             </select>
        </div>

        <div id="progress-info">
             <span id="progress-text">Pergunta: 1 / 20</span>
             <span id="score-text">Pontos: 0</span>
        </div>

        <div class="question" id="question">Carregando pergunta...</div>
        <div class="options" id="options"></div>
        <div id="feedback"></div>
        <div id="result"></div>

        <div class="action-buttons">
            <button id="restart" onclick="startQuiz()">üîÑ Recome√ßar</button>
            <button id="skip" onclick="skipQuestion()">‚è≠ Pular</button>
            <button id="hint" onclick="showHint()">üí° Dica</button>
        </div>
    </div>

    <!-- =================================================================== -->
    <!-- == IMPORTANTE: Baixe os arquivos MP3 para a mesma pasta deste HTML == -->
    <!-- ==            e use os nomes de arquivo abaixo (correct.mp3, etc.) == -->
    <!-- =================================================================== -->
    <audio id="correctSound" preload="auto" src="correct.mp3"></audio>
    <audio id="wrongSound" preload="auto" src="wrong.mp3"></audio>
    <audio id="backgroundMusic" loop preload="auto" src="background.mp3"></audio>

    <!-- Mute Button (Placed outside container for fixed positioning) -->
    <button id="muteButton" title="Mute/Unmute M√∫sica">üéµ</button>


    <script>
        // Vocabulary Data (levels object as before)
        const levels = {
          "HSK1": [{"Ê±âÂ≠ó": "Áà±", "Pinyin": "√†i", "Portugu√™s": "amar", "HSK": 1}, {"Ê±âÂ≠ó": "ÂÖ´", "Pinyin": "bƒÅ", "Portugu√™s": "oito", "HSK": 1}, {"Ê±âÂ≠ó": "Áà∏Áà∏", "Pinyin": "b√†ba", "Portugu√™s": "pai", "HSK": 1}, {"Ê±âÂ≠ó": "ÊùØÂ≠ê", "Pinyin": "bƒìizi", "Portugu√™s": "copo", "HSK": 1}, {"Ê±âÂ≠ó": "Âåó‰∫¨", "Pinyin": "Bƒõijƒ´ng", "Portugu√™s": "Pequim", "HSK": 1}, {"Ê±âÂ≠ó": "Êú¨", "Pinyin": "bƒõn", "Portugu√™s": "classificador para livros", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏ç", "Pinyin": "b√π", "Portugu√™s": "n√£o", "HSK": 1}, {"Ê±âÂ≠ó": "Ëèú", "Pinyin": "c√†i", "Portugu√™s": "prato, vegetais", "HSK": 1}, {"Ê±âÂ≠ó": "Ëå∂", "Pinyin": "ch√°", "Portugu√™s": "ch√°", "HSK": 1}, {"Ê±âÂ≠ó": "ÂêÉ", "Pinyin": "chƒ´", "Portugu√™s": "comer", "HSK": 1}, {"Ê±âÂ≠ó": "Âá∫ÁßüËΩ¶", "Pinyin": "ch≈´z≈´chƒì", "Portugu√™s": "t√°xi", "HSK": 1}, {"Ê±âÂ≠ó": "ÊâìÁîµËØù", "Pinyin": "d«é di√†nhu√†", "Portugu√™s": "ligar (telefone)", "HSK": 1}, {"Ê±âÂ≠ó": "Â§ß", "Pinyin": "d√†", "Portugu√™s": "grande", "HSK": 1}, {"Ê±âÂ≠ó": "ÁöÑ", "Pinyin": "de", "Portugu√™s": "part√≠cula de posse", "HSK": 1}, {"Ê±âÂ≠ó": "ÁÇπ", "Pinyin": "di«én", "Portugu√™s": "hora, ponto", "HSK": 1}, {"Ê±âÂ≠ó": "ÁîµËÑë", "Pinyin": "di√†nn«éo", "Portugu√™s": "computador", "HSK": 1}, {"Ê±âÂ≠ó": "ÁîµËßÜ", "Pinyin": "di√†nsh√¨", "Portugu√™s": "televis√£o", "HSK": 1}, {"Ê±âÂ≠ó": "ÁîµÂΩ±", "Pinyin": "di√†ny«êng", "Portugu√™s": "filme", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏úË•ø", "Pinyin": "d≈çngxi", "Portugu√™s": "coisa", "HSK": 1}, {"Ê±âÂ≠ó": "ÈÉΩ", "Pinyin": "d≈çu", "Portugu√™s": "todos", "HSK": 1}, {"Ê±âÂ≠ó": "ËØª", "Pinyin": "d√∫", "Portugu√™s": "ler", "HSK": 1}, {"Ê±âÂ≠ó": "ÂØπ‰∏çËµ∑", "Pinyin": "du√¨buq«ê", "Portugu√™s": "desculpe", "HSK": 1}, {"Ê±âÂ≠ó": "Â§ö", "Pinyin": "du≈ç", "Portugu√™s": "muito", "HSK": 1}, {"Ê±âÂ≠ó": "Â§öÂ∞ë", "Pinyin": "du≈çsh«éo", "Portugu√™s": "quanto", "HSK": 1}, {"Ê±âÂ≠ó": "ÂÑøÂ≠ê", "Pinyin": "√©rzi", "Portugu√™s": "filho", "HSK": 1}, {"Ê±âÂ≠ó": "‰∫å", "Pinyin": "√®r", "Portugu√™s": "dois", "HSK": 1}, {"Ê±âÂ≠ó": "È•≠Â∫ó", "Pinyin": "f√†ndi√†n", "Portugu√™s": "restaurante", "HSK": 1}, {"Ê±âÂ≠ó": "È£ûÊú∫", "Pinyin": "fƒìijƒ´", "Portugu√™s": "avi√£o", "HSK": 1}, {"Ê±âÂ≠ó": "ÂàÜÈíü", "Pinyin": "fƒìnzh≈çng", "Portugu√™s": "minuto", "HSK": 1}, {"Ê±âÂ≠ó": "È´òÂÖ¥", "Pinyin": "gƒÅox√¨ng", "Portugu√™s": "feliz", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏™", "Pinyin": "g√®", "Portugu√™s": "classificador geral", "HSK": 1}, {"Ê±âÂ≠ó": "Â∑•‰Ωú", "Pinyin": "g≈çngzu√≤", "Portugu√™s": "trabalho", "HSK": 1}, {"Ê±âÂ≠ó": "Áãó", "Pinyin": "g«íu", "Portugu√™s": "cachorro", "HSK": 1}, {"Ê±âÂ≠ó": "Ê±âËØ≠", "Pinyin": "H√†ny«î", "Portugu√™s": "l√≠ngua chinesa", "HSK": 1}, {"Ê±âÂ≠ó": "Â•Ω", "Pinyin": "h«éo", "Portugu√™s": "bom", "HSK": 1}, {"Ê±âÂ≠ó": "Âè∑", "Pinyin": "h√†o", "Portugu√™s": "n√∫mero", "HSK": 1}, {"Ê±âÂ≠ó": "Âñù", "Pinyin": "hƒì", "Portugu√™s": "beber", "HSK": 1}, {"Ê±âÂ≠ó": "Âíå", "Pinyin": "h√©", "Portugu√™s": "e", "HSK": 1}, {"Ê±âÂ≠ó": "Âæà", "Pinyin": "hƒõn", "Portugu√™s": "muito", "HSK": 1}, {"Ê±âÂ≠ó": "ÂêéÈù¢", "Pinyin": "h√≤umian", "Portugu√™s": "atr√°s", "HSK": 1}, {"Ê±âÂ≠ó": "Âõû", "Pinyin": "hu√≠", "Portugu√™s": "voltar", "HSK": 1}, {"Ê±âÂ≠ó": "‰ºö", "Pinyin": "hu√¨", "Portugu√™s": "saber (fazer algo)", "HSK": 1}, {"Ê±âÂ≠ó": "Âá†", "Pinyin": "j«ê", "Portugu√™s": "quantos", "HSK": 1}, {"Ê±âÂ≠ó": "ÂÆ∂", "Pinyin": "jiƒÅ", "Portugu√™s": "fam√≠lia, casa", "HSK": 1}, {"Ê±âÂ≠ó": "Âè´", "Pinyin": "ji√†o", "Portugu√™s": "chamar-se", "HSK": 1}, {"Ê±âÂ≠ó": "‰ªäÂ§©", "Pinyin": "jƒ´ntiƒÅn", "Portugu√™s": "hoje", "HSK": 1}, {"Ê±âÂ≠ó": "‰πù", "Pinyin": "ji«î", "Portugu√™s": "nove", "HSK": 1}, {"Ê±âÂ≠ó": "ÂºÄ", "Pinyin": "kƒÅi", "Portugu√™s": "abrir, dirigir", "HSK": 1}, {"Ê±âÂ≠ó": "Áúã", "Pinyin": "k√†n", "Portugu√™s": "ver", "HSK": 1}, {"Ê±âÂ≠ó": "ÁúãËßÅ", "Pinyin": "k√†nji√†n", "Portugu√™s": "enxergar", "HSK": 1}, {"Ê±âÂ≠ó": "Âùó", "Pinyin": "ku√†i", "Portugu√™s": "unidade monet√°ria (informal)", "HSK": 1}, {"Ê±âÂ≠ó": "Êù•", "Pinyin": "l√°i", "Portugu√™s": "vir", "HSK": 1}, {"Ê±âÂ≠ó": "ËÄÅÂ∏à", "Pinyin": "l«éoshƒ´", "Portugu√™s": "professor(a)", "HSK": 1}, {"Ê±âÂ≠ó": "‰∫Ü", "Pinyin": "le", "Portugu√™s": "part√≠cula de a√ß√£o conclu√≠da", "HSK": 1}, {"Ê±âÂ≠ó": "ÂÜ∑", "Pinyin": "lƒõng", "Portugu√™s": "frio", "HSK": 1}, {"Ê±âÂ≠ó": "Èáå", "Pinyin": "l«ê", "Portugu√™s": "dentro", "HSK": 1}, {"Ê±âÂ≠ó": "ÂÖ≠", "Pinyin": "li√π", "Portugu√™s": "seis", "HSK": 1}, {"Ê±âÂ≠ó": "Â¶àÂ¶à", "Pinyin": "mƒÅma", "Portugu√™s": "m√£e", "HSK": 1}, {"Ê±âÂ≠ó": "Âêó", "Pinyin": "ma", "Portugu√™s": "part√≠cula interrogativa", "HSK": 1}, {"Ê±âÂ≠ó": "‰π∞", "Pinyin": "m«éi", "Portugu√™s": "comprar", "HSK": 1}, {"Ê±âÂ≠ó": "Áå´", "Pinyin": "mƒÅo", "Portugu√™s": "gato", "HSK": 1}, {"Ê±âÂ≠ó": "Ê≤°", "Pinyin": "m√©i", "Portugu√™s": "n√£o (passado)", "HSK": 1}, {"Ê±âÂ≠ó": "Ê≤°ÂÖ≥Á≥ª", "Pinyin": "m√©iguƒÅnxi", "Portugu√™s": "n√£o tem problema", "HSK": 1}, {"Ê±âÂ≠ó": "Á±≥È•≠", "Pinyin": "m«êf√†n", "Portugu√™s": "arroz cozido", "HSK": 1}, {"Ê±âÂ≠ó": "ÊòéÂ§©", "Pinyin": "m√≠ngtiƒÅn", "Portugu√™s": "amanh√£", "HSK": 1}, {"Ê±âÂ≠ó": "ÂêçÂ≠ó", "Pinyin": "m√≠ngzi", "Portugu√™s": "nome", "HSK": 1}, {"Ê±âÂ≠ó": "Âì™", "Pinyin": "n«é", "Portugu√™s": "qual", "HSK": 1}, {"Ê±âÂ≠ó": "Âì™ÂÑø", "Pinyin": "n«ér", "Portugu√™s": "onde", "HSK": 1}, {"Ê±âÂ≠ó": "ÈÇ£", "Pinyin": "n√†", "Portugu√™s": "aquele", "HSK": 1}, {"Ê±âÂ≠ó": "ÈÇ£ÂÑø", "Pinyin": "n√†r", "Portugu√™s": "l√°", "HSK": 1}, {"Ê±âÂ≠ó": "Âë¢", "Pinyin": "ne", "Portugu√™s": "part√≠cula de √™nfase ou elipse", "HSK": 1}, {"Ê±âÂ≠ó": "ËÉΩ", "Pinyin": "n√©ng", "Portugu√™s": "poder", "HSK": 1}, {"Ê±âÂ≠ó": "‰Ω†", "Pinyin": "n«ê", "Portugu√™s": "voc√™", "HSK": 1}, {"Ê±âÂ≠ó": "Âπ¥", "Pinyin": "ni√°n", "Portugu√™s": "ano", "HSK": 1}, {"Ê±âÂ≠ó": "Â•≥ÂÑø", "Pinyin": "n«ö'√©r", "Portugu√™s": "filha", "HSK": 1}, {"Ê±âÂ≠ó": "ÊúãÂèã", "Pinyin": "p√©ngyou", "Portugu√™s": "amigo(a)", "HSK": 1}, {"Ê±âÂ≠ó": "ÊºÇ‰∫Æ", "Pinyin": "pi√†oliang", "Portugu√™s": "bonito(a)", "HSK": 1}, {"Ê±âÂ≠ó": "ËãπÊûú", "Pinyin": "p√≠nggu«í", "Portugu√™s": "ma√ß√£", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏É", "Pinyin": "qƒ´", "Portugu√™s": "sete", "HSK": 1}, {"Ê±âÂ≠ó": "ÂâçÈù¢", "Pinyin": "qi√°nmian", "Portugu√™s": "na frente", "HSK": 1}, {"Ê±âÂ≠ó": "Èí±", "Pinyin": "qi√°n", "Portugu√™s": "dinheiro", "HSK": 1}, {"Ê±âÂ≠ó": "ËØ∑", "Pinyin": "q«êng", "Portugu√™s": "por favor", "HSK": 1}, {"Ê±âÂ≠ó": "Âéª", "Pinyin": "q√π", "Portugu√™s": "ir", "HSK": 1}, {"Ê±âÂ≠ó": "ÁÉ≠", "Pinyin": "r√®", "Portugu√™s": "quente", "HSK": 1}, {"Ê±âÂ≠ó": "‰∫∫", "Pinyin": "r√©n", "Portugu√™s": "pessoa", "HSK": 1}, {"Ê±âÂ≠ó": "ËÆ§ËØÜ", "Pinyin": "r√®nshi", "Portugu√™s": "conhecer", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏â", "Pinyin": "sƒÅn", "Portugu√™s": "tr√™s", "HSK": 1}, {"Ê±âÂ≠ó": "ÂïÜÂ∫ó", "Pinyin": "shƒÅngdi√†n", "Portugu√™s": "loja", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏ä", "Pinyin": "sh√†ng", "Portugu√™s": "em cima", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏äÂçà", "Pinyin": "sh√†ngw«î", "Portugu√™s": "manh√£", "HSK": 1}, {"Ê±âÂ≠ó": "Â∞ë", "Pinyin": "sh«éo", "Portugu√™s": "pouco", "HSK": 1}, {"Ê±âÂ≠ó": "Ë∞Å", "Pinyin": "sh√©i", "Portugu√™s": "quem", "HSK": 1}, {"Ê±âÂ≠ó": "‰ªÄ‰πà", "Pinyin": "sh√©nme", "Portugu√™s": "o qu√™", "HSK": 1}, {"Ê±âÂ≠ó": "ÂçÅ", "Pinyin": "sh√≠", "Portugu√™s": "dez", "HSK": 1}, {"Ê±âÂ≠ó": "Êó∂ÂÄô", "Pinyin": "sh√≠hou", "Portugu√™s": "tempo (momento)", "HSK": 1}, {"Ê±âÂ≠ó": "ÊòØ", "Pinyin": "sh√¨", "Portugu√™s": "ser", "HSK": 1}, {"Ê±âÂ≠ó": "‰π¶", "Pinyin": "sh≈´", "Portugu√™s": "livro", "HSK": 1}, {"Ê±âÂ≠ó": "Ê∞¥", "Pinyin": "shu«ê", "Portugu√™s": "√°gua", "HSK": 1}, {"Ê±âÂ≠ó": "Ê∞¥Êûú", "Pinyin": "shu«êgu«í", "Portugu√™s": "fruta", "HSK": 1}, {"Ê±âÂ≠ó": "Áù°Ëßâ", "Pinyin": "shu√¨ji√†o", "Portugu√™s": "dormir", "HSK": 1}, {"Ê±âÂ≠ó": "ËØ¥", "Pinyin": "shu≈ç", "Portugu√™s": "falar", "HSK": 1}, {"Ê±âÂ≠ó": "Âõõ", "Pinyin": "s√¨", "Portugu√™s": "quatro", "HSK": 1}, {"Ê±âÂ≠ó": "Â≤Å", "Pinyin": "su√¨", "Portugu√™s": "idade/anos", "HSK": 1}, {"Ê±âÂ≠ó": "‰ªñ", "Pinyin": "tƒÅ", "Portugu√™s": "ele", "HSK": 1}, {"Ê±âÂ≠ó": "Â•π", "Pinyin": "tƒÅ", "Portugu√™s": "ela", "HSK": 1}, {"Ê±âÂ≠ó": "Â§™", "Pinyin": "t√†i", "Portugu√™s": "demais", "HSK": 1}, {"Ê±âÂ≠ó": "Â§©Ê∞î", "Pinyin": "tiƒÅnq√¨", "Portugu√™s": "clima", "HSK": 1}, {"Ê±âÂ≠ó": "Âê¨", "Pinyin": "tƒ´ng", "Portugu√™s": "ouvir", "HSK": 1}, {"Ê±âÂ≠ó": "ÂêåÂ≠¶", "Pinyin": "t√≥ngxu√©", "Portugu√™s": "colega de classe", "HSK": 1}, {"Ê±âÂ≠ó": "ÂñÇ", "Pinyin": "w√®i", "Portugu√™s": "al√¥ (telefone)", "HSK": 1}, {"Ê±âÂ≠ó": "Êàë", "Pinyin": "w«í", "Portugu√™s": "eu", "HSK": 1}, {"Ê±âÂ≠ó": "Êàë‰ª¨", "Pinyin": "w«ímen", "Portugu√™s": "n√≥s", "HSK": 1}, {"Ê±âÂ≠ó": "‰∫î", "Pinyin": "w«î", "Portugu√™s": "cinco", "HSK": 1}, {"Ê±âÂ≠ó": "ÂñúÊ¨¢", "Pinyin": "x«êhuan", "Portugu√™s": "gostar", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏ã", "Pinyin": "xi√†", "Portugu√™s": "embaixo", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏ãÂçà", "Pinyin": "xi√†w«î", "Portugu√™s": "tarde (per√≠odo)", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏ãÈõ®", "Pinyin": "xi√†y«î", "Portugu√™s": "chover", "HSK": 1}, {"Ê±âÂ≠ó": "ÂÖàÁîü", "Pinyin": "xiƒÅnsheng", "Portugu√™s": "senhor", "HSK": 1}, {"Ê±âÂ≠ó": "Áé∞Âú®", "Pinyin": "xi√†nz√†i", "Portugu√™s": "agora", "HSK": 1}, {"Ê±âÂ≠ó": "ÊÉ≥", "Pinyin": "xi«éng", "Portugu√™s": "querer/pensar", "HSK": 1}, {"Ê±âÂ≠ó": "Â∞è", "Pinyin": "xi«éo", "Portugu√™s": "pequeno", "HSK": 1}, {"Ê±âÂ≠ó": "Â∞èÂßê", "Pinyin": "xi«éojiƒõ", "Portugu√™s": "senhorita", "HSK": 1}, {"Ê±âÂ≠ó": "‰∫õ", "Pinyin": "xiƒì", "Portugu√™s": "alguns", "HSK": 1}, {"Ê±âÂ≠ó": "ÂÜô", "Pinyin": "xiƒõ", "Portugu√™s": "escrever", "HSK": 1}, {"Ê±âÂ≠ó": "Ë∞¢Ë∞¢", "Pinyin": "xi√®xie", "Portugu√™s": "obrigado", "HSK": 1}, {"Ê±âÂ≠ó": "ÊòüÊúü", "Pinyin": "xƒ´ngqƒ´", "Portugu√™s": "semana", "HSK": 1}, {"Ê±âÂ≠ó": "Â≠¶Áîü", "Pinyin": "xu√©sheng", "Portugu√™s": "estudante", "HSK": 1}, {"Ê±âÂ≠ó": "Â≠¶‰π†", "Pinyin": "xu√©x√≠", "Portugu√™s": "estudar", "HSK": 1}, {"Ê±âÂ≠ó": "Â≠¶Ê†°", "Pinyin": "xu√©xi√†o", "Portugu√™s": "escola", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏Ä", "Pinyin": "yƒ´", "Portugu√™s": "um", "HSK": 1}, {"Ê±âÂ≠ó": "Ë°£Êúç", "Pinyin": "yƒ´fu", "Portugu√™s": "roupa", "HSK": 1}, {"Ê±âÂ≠ó": "ÂåªÁîü", "Pinyin": "yƒ´shƒìng", "Portugu√™s": "m√©dico", "HSK": 1}, {"Ê±âÂ≠ó": "ÂåªÈô¢", "Pinyin": "yƒ´yu√†n", "Portugu√™s": "hospital", "HSK": 1}, {"Ê±âÂ≠ó": "Ê§ÖÂ≠ê", "Pinyin": "y«êzi", "Portugu√™s": "cadeira", "HSK": 1}, {"Ê±âÂ≠ó": "Êúâ", "Pinyin": "y«íu", "Portugu√™s": "ter", "HSK": 1}, {"Ê±âÂ≠ó": "Êúà", "Pinyin": "yu√®", "Portugu√™s": "m√™s", "HSK": 1}, {"Ê±âÂ≠ó": "Âú®", "Pinyin": "z√†i", "Portugu√™s": "estar em", "HSK": 1}, {"Ê±âÂ≠ó": "ÂÜçËßÅ", "Pinyin": "z√†iji√†n", "Portugu√™s": "tchau", "HSK": 1}, {"Ê±âÂ≠ó": "ÊÄé‰πà", "Pinyin": "zƒõnme", "Portugu√™s": "como", "HSK": 1}, {"Ê±âÂ≠ó": "ÊÄé‰πàÊ†∑", "Pinyin": "zƒõnmey√†ng", "Portugu√™s": "que tal", "HSK": 1}, {"Ê±âÂ≠ó": "Ëøô", "Pinyin": "zh√®", "Portugu√™s": "este", "HSK": 1}, {"Ê±âÂ≠ó": "ËøôÂÑø", "Pinyin": "zh√®r", "Portugu√™s": "aqui", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏≠ÂõΩ", "Pinyin": "Zh≈çnggu√≥", "Portugu√™s": "China", "HSK": 1}, {"Ê±âÂ≠ó": "‰∏≠Âçà", "Pinyin": "zh≈çngw«î", "Portugu√™s": "meio-dia", "HSK": 1}, {"Ê±âÂ≠ó": "‰Ωè", "Pinyin": "zh√π", "Portugu√™s": "morar", "HSK": 1}, {"Ê±âÂ≠ó": "Ê°åÂ≠ê", "Pinyin": "zhu≈çzi", "Portugu√™s": "mesa", "HSK": 1}, {"Ê±âÂ≠ó": "Â≠ó", "Pinyin": "z√¨", "Portugu√™s": "caractere", "HSK": 1}, {"Ê±âÂ≠ó": "Êò®Â§©", "Pinyin": "zu√≥tiƒÅn", "Portugu√™s": "ontem", "HSK": 1}, {"Ê±âÂ≠ó": "ÂÅö", "Pinyin": "zu√≤", "Portugu√™s": "fazer", "HSK": 1}, {"Ê±âÂ≠ó": "Âùê", "Pinyin": "zu√≤", "Portugu√™s": "sentar", "HSK": 1}]
          // ... HSK2, HSK3 etc. data ...
        };

        // DOM Elements (Add backgroundMusic and muteButton)
        const startScreen = document.getElementById("start-screen");
        const startButton = document.getElementById("start-button"); // Should find the button now if HTML is correct
        const quizContainer = document.getElementById("quiz-container");
        const levelSelect = document.getElementById("levelSelect");
        const questionEl = document.getElementById("question");
        const optionsEl = document.getElementById("options");
        const feedbackEl = document.getElementById("feedback");
        const resultEl = document.getElementById("result");
        const restartButton = document.getElementById("restart");
        const skipButton = document.getElementById("skip");
        const hintButton = document.getElementById("hint");
        const progressTextEl = document.getElementById("progress-text");
        const scoreTextEl = document.getElementById("score-text");
        const correctSound = document.getElementById("correctSound");
        const wrongSound = document.getElementById("wrongSound");
        const backgroundMusic = document.getElementById("backgroundMusic");
        const muteButton = document.getElementById("muteButton");
        const actionButtonsEl = document.querySelector(".action-buttons");

        // State Variables
        let allQuestions = [];
        let currentQuestions = [];
        let currentQuestionIndex = 0;
        let score = 0;
        let currentLevelWords = [];
        const questionsPerRound = 20;
        let isMuted = false;
        let audioUnlocked = false;

        // --- Utility Functions ---
        function shuffle(arr) {
            for (let i = arr.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [arr[i], arr[j]] = [arr[j], arr[i]];
            }
            return arr;
        }

        function getOptions(correctAnswer, fieldToSample, wordPool) {
            const options = new Set([correctAnswer]);
            const poolSize = wordPool.length;
            let attempts = 0;
            const maxAttempts = poolSize * 2;

            while (options.size < 4 && attempts < maxAttempts) {
                const randomIndex = Math.floor(Math.random() * poolSize);
                // Ensure wordPool[randomIndex] exists before accessing field
                if(wordPool[randomIndex]){
                    const randomOption = wordPool[randomIndex][fieldToSample];
                    if (randomOption && !options.has(randomOption)) {
                         options.add(randomOption);
                    }
                }
                attempts++;
            }
             while (options.size < 4) {
                 options.add(`Op√ß√£o ${options.size + 1}`);
             }
            return shuffle([...options]);
        }


        // --- Audio Handling ---
        function unlockAudio() {
            if (audioUnlocked) return;
             console.log("Tentando destravar contexto de √°udio...");
             const sounds = [correctSound, wrongSound, backgroundMusic];
             let promises = [];

             sounds.forEach(sound => {
                 if(sound) {
                     // Set volume low to avoid blast if it plays briefly
                     const originalVolume = sound.volume;
                     sound.volume = 0.01;
                     let promise = sound.play();
                     if (promise !== undefined) {
                         promises.push(
                             promise.then(() => {
                                 sound.pause();
                                 sound.currentTime = 0;
                                 sound.volume = originalVolume; // Restore volume
                                 console.log(sound.id + " destravado.");
                             }).catch(error => {
                                 // console.warn("Destravamento falhou para " + sound.id + " (esperado em alguns casos):", error.message);
                                 sound.volume = originalVolume; // Restore volume even on failure
                             })
                         );
                     }
                 }
             });

             // Wait for all unlock attempts before declaring unlocked
             Promise.all(promises).then(() => {
                 console.log("Tentativas de destravamento conclu√≠das.");
                 audioUnlocked = true;
                 // Try playing background music again now that context *should* be active
                 playBackgroundMusic();
             }).catch(() => {
                 console.warn("Algumas tentativas de destravamento falharam, mas definindo audioUnlocked como true de qualquer maneira.");
                  audioUnlocked = true; // Still set to true, the user click is the main trigger
             });
        }


         function playSound(soundElement) {
             if (soundElement && audioUnlocked) {
                 soundElement.currentTime = 0;
                 soundElement.play().catch(error => console.error("Erro ao tocar som ("+soundElement.id+ "):", error));
             } else if (!audioUnlocked) {
                 console.warn("Contexto de √°udio n√£o destravado. Som "+soundElement.id+" pulado.");
             } else if (!soundElement) {
                 console.warn("Tentativa de tocar elemento de som nulo.");
             }
         }

         function playBackgroundMusic() {
             // Only play if audio is unlocked and not muted
             if (backgroundMusic && !isMuted && audioUnlocked) {
                 console.log("Tentando tocar m√∫sica de fundo...");
                 backgroundMusic.play().catch(error => {
                     // Common error: "play() failed because the user didn't interact with the document first"
                     // Or "The play() request was interrupted" - less common here
                      console.warn("Falha ao tocar m√∫sica de fundo:", error.message);
                      // We might need another user interaction if unlockAudio wasn't enough initially
                 });
             } else {
                 console.log("M√∫sica de fundo n√£o tocada (Muted: "+isMuted+", Unlocked: "+audioUnlocked+")");
             }
         }

         function pauseBackgroundMusic() {
             if (backgroundMusic) {
                 backgroundMusic.pause();
                 console.log("M√∫sica de fundo pausada.");
             }
         }

         function toggleMute() {
             isMuted = !isMuted;
             if(backgroundMusic) { // Check if element exists
                 backgroundMusic.muted = isMuted;
                 muteButton.textContent = isMuted ? 'üîá' : 'üéµ';
                 console.log("Mute Toggled: ", isMuted);
                 if (!isMuted) {
                     playBackgroundMusic(); // Try to play if unmuting
                 }
             } else {
                 console.warn("Elemento backgroundMusic n√£o encontrado para toggleMute.");
             }
         }

        // --- Core Quiz Logic ---
        function loadLevelWords(selectedLevel) {
             currentLevelWords = [];
             const selectedLevelNum = parseInt(selectedLevel.replace('HSK', ''), 10);
             for (let i = 1; i <= selectedLevelNum; i++) {
                 const levelKey = `HSK${i}`;
                 if (levels[levelKey]) {
                     currentLevelWords = currentLevelWords.concat(levels[levelKey]);
                 } else {
                     console.warn(`Dados para ${levelKey} n√£o encontrados.`);
                 }
             }
             const uniqueWords = new Map();
             currentLevelWords.forEach(word => {
                 if (word && word['Ê±âÂ≠ó'] && !uniqueWords.has(word['Ê±âÂ≠ó'])) {
                     uniqueWords.set(word['Ê±âÂ≠ó'], word);
                 }
             });
             currentLevelWords = Array.from(uniqueWords.values());

             if (currentLevelWords.length === 0) {
                  console.error("Nenhuma palavra carregada para o n√≠vel selecionado!");
                  questionEl.textContent = "Erro: N√£o foi poss√≠vel carregar palavras para este n√≠vel.";
                  optionsEl.innerHTML = "";
                  return false;
             }
             return true;
         }

        function generateQuestions() {
             allQuestions = [];
             if (currentLevelWords.length === 0) return;

             currentLevelWords.forEach(wordData => {
                 if (!wordData || !wordData['Ê±âÂ≠ó'] || !wordData['Portugu√™s'] || !wordData['Pinyin']) {
                    console.warn("Pulando dados de palavra incompletos:", wordData);
                    return;
                 }
                 allQuestions.push({
                     type: "hanzi_to_pt",
                     questionText: `Qual o significado de: "${wordData['Ê±âÂ≠ó']}"?`,
                     correctAnswer: wordData["Portugu√™s"],
                     options: getOptions(wordData["Portugu√™s"], "Portugu√™s", currentLevelWords),
                     details: wordData
                 });
                 allQuestions.push({
                     type: "pt_to_hanzi",
                     questionText: `Como se escreve em chin√™s: "${wordData['Portugu√™s']}"?`,
                     correctAnswer: wordData["Ê±âÂ≠ó"],
                     options: getOptions(wordData["Ê±âÂ≠ó"], "Ê±âÂ≠ó", currentLevelWords),
                     details: wordData
                 });
                  allQuestions.push({
                      type: "pinyin_to_pt",
                      questionText: `Qual o significado de: "${wordData['Pinyin']}"?`,
                      correctAnswer: wordData["Portugu√™s"],
                      options: getOptions(wordData["Portugu√™s"], "Portugu√™s", currentLevelWords),
                      details: wordData
                  });
             });

             allQuestions = shuffle(allQuestions);
             currentQuestions = allQuestions.slice(0, Math.min(questionsPerRound, allQuestions.length));

             if (currentQuestions.length === 0 && currentLevelWords.length > 0) {
                 console.error("Falha ao gerar perguntas mesmo com palavras carregadas.");
                  questionEl.textContent = "Erro ao gerar perguntas.";
                  optionsEl.innerHTML = "";
             }
         }

        function displayQuestion() {
              if (currentQuestionIndex >= currentQuestions.length) {
                 showResult();
                 return;
             }
             hideFeedback();
             resultEl.style.display = 'none';
             actionButtonsEl.style.display = 'flex';

             const currentQ = currentQuestions[currentQuestionIndex];
             questionEl.textContent = currentQ.questionText;
             optionsEl.innerHTML = "";
             optionsEl.style.pointerEvents = 'auto';

             skipButton.disabled = false;
             hintButton.disabled = false;

             currentQ.options.forEach(option => {
                 const btn = document.createElement("button");
                 btn.textContent = option;
                 btn.onclick = () => handleAnswer(btn, option);
                 optionsEl.appendChild(btn);
             });
             updateProgress();
         }

        function handleAnswer(buttonEl, selectedOption) {
             document.querySelectorAll("#options button").forEach(btn => { btn.disabled = true; });
             optionsEl.style.pointerEvents = 'none';
             skipButton.disabled = true;
             hintButton.disabled = true;

             const currentQ = currentQuestions[currentQuestionIndex];
             const isCorrect = selectedOption === currentQ.correctAnswer;

             document.querySelectorAll("#options button").forEach(btn => {
                 if (btn.textContent === currentQ.correctAnswer) {
                     btn.classList.add("correct");
                 } else if (btn === buttonEl) {
                     btn.classList.add("wrong");
                 }
             });

             if (isCorrect) {
                 score++;
                 feedbackEl.textContent = "‚úÖ Correto!";
                 feedbackEl.className = 'correct-feedback';
                 playSound(correctSound); // Play sound effect
             } else {
                 feedbackEl.textContent = `‚ùå Errado. Correto: ${currentQ.correctAnswer} (Pinyin: ${currentQ.details.Pinyin})`;
                 feedbackEl.className = 'wrong-feedback';
                 playSound(wrongSound); // Play sound effect
             }
             feedbackEl.style.display = 'block';
             updateProgress();

             setTimeout(() => {
                 currentQuestionIndex++;
                 if (currentQuestionIndex < currentQuestions.length) {
                     displayQuestion();
                 } else {
                     showResult();
                 }
             }, 1800);
         }

         function skipQuestion() {
             const currentQ = currentQuestions[currentQuestionIndex];
             feedbackEl.textContent = `‚è≠ Pergunta pulada. Resposta: ${currentQ.correctAnswer} (Pinyin: ${currentQ.details.Pinyin})`;
             feedbackEl.className = 'hint-feedback';
             feedbackEl.style.display = 'block';
             // playSound(wrongSound); // Opcional

             optionsEl.style.pointerEvents = 'none';
             document.querySelectorAll("#options button").forEach(btn => { btn.disabled = true;});
             skipButton.disabled = true;
             hintButton.disabled = true;

             setTimeout(() => {
                  currentQuestionIndex++;
                  if (currentQuestionIndex < currentQuestions.length) {
                      displayQuestion();
                  } else {
                      showResult();
                  }
             }, 1800);
         }

        function showHint() {
             const currentQ = currentQuestions[currentQuestionIndex];
             feedbackEl.textContent = `üí° Dica: A resposta come√ßa com '${currentQ.correctAnswer.charAt(0)}'`;
             feedbackEl.className = 'hint-feedback';
             feedbackEl.style.display = 'block';
             hintButton.disabled = true;
         }

        function showResult() {
              questionEl.textContent = "Quiz Finalizado!";
              optionsEl.innerHTML = "";
              hideFeedback();
              actionButtonsEl.style.display = 'none';

              const percentage = currentQuestions.length > 0 ? Math.round((score / currentQuestions.length) * 100) : 0;
              resultEl.textContent = `Voc√™ acertou ${score} de ${currentQuestions.length} perguntas (${percentage}%).`;
              resultEl.style.display = 'block';

              restartButton.style.display = 'block';
              restartButton.style.margin = '20px auto';
              actionButtonsEl.style.display = 'flex';
              skipButton.style.display = 'none';
              hintButton.style.display = 'none';

              pauseBackgroundMusic();
         }

        function updateProgress() {
              const total = currentQuestions.length;
              const currentNum = Math.min(currentQuestionIndex + 1, total);
              progressTextEl.textContent = `Pergunta: ${currentNum} / ${total}`;
              scoreTextEl.textContent = `Pontos: ${score}`;
         }

        function hideFeedback() {
             feedbackEl.style.display = 'none';
             feedbackEl.textContent = '';
             feedbackEl.className = '';
         }

        function startQuiz() {
             console.log("Iniciando o quiz...");
             const selectedLevel = levelSelect.value;

             if (!loadLevelWords(selectedLevel)) { return; }

              score = 0;
              currentQuestionIndex = 0;
              generateQuestions();

              if (currentQuestions.length === 0) {
                 console.error("Nenhuma pergunta gerada para o n√≠vel "+ selectedLevel);
                 questionEl.textContent = "Nenhuma pergunta dispon√≠vel para este n√≠vel.";
                 optionsEl.innerHTML = "";
                 actionButtonsEl.style.display = 'none';
                 return;
             }

              hideFeedback();
              resultEl.style.display = 'none';
              skipButton.style.display = 'inline-block';
              hintButton.style.display = 'inline-block';
              restartButton.style.display = 'inline-block';
              actionButtonsEl.style.display = 'flex';

              displayQuestion();
              playBackgroundMusic(); // Tenta tocar m√∫sica de fundo
         }

        function confirmLevelChange() {
             console.log("N√≠vel alterado, reiniciando quiz.");
             startQuiz();
         }


        // --- Initialization ---
        // Event listener para o bot√£o Iniciar
        if (startButton) { // Verifica se o bot√£o foi encontrado antes de adicionar listener
            startButton.addEventListener('click', () => {
                console.log("Bot√£o Iniciar clicado.");
                unlockAudio(); // Tenta destravar o √°udio na primeira intera√ß√£o
                startScreen.style.display = 'none';
                quizContainer.style.display = 'flex';
                if (muteButton) muteButton.style.display = 'flex'; // Mostra o bot√£o mute
                startQuiz();
            });
        } else {
            // ERRO CR√çTICO: Se chegou aqui, o bot√£o Iniciar *ainda* n√£o foi encontrado.
            // Isso impede o in√≠cio do quiz. Verifique o ID no HTML!
            console.error("ERRO CR√çTICO: O elemento #start-button n√£o foi encontrado no HTML!");
            // Opcional: Mostrar uma mensagem de erro na p√°gina
            document.body.innerHTML = "<h1 style='color: red;'>Erro: Elemento 'start-button' n√£o encontrado. Verifique o HTML.</h1>";
        }


        // Event listener para o bot√£o Mute
        if(muteButton) {
            muteButton.addEventListener('click', toggleMute);
             // Esconde inicialmente
             muteButton.style.display = 'none';
        } else {
            console.warn("Bot√£o Mute n√£o encontrado.");
        }


        // Define volume inicial da m√∫sica (opcional)
        if (backgroundMusic) {
            backgroundMusic.volume = 0.3;
        }

    </script>
</body>
</html>